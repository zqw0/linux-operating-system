# 内核同步  
## 临界区和竞争条件  
**临界区**：就是访问和操作共享数据的代码段。比如：两个线程同时修改a变量，就有可能造成不可预知的变量赋值。  
**竞争条件**：就是说两个线程有可能同时修改a变量，同时竞争a。这就是竞争条件。  
**同步**：为了避免上述这种竞争条件，我们称之为同步。  
eg:
```
i++的例子。
线程1                   线程2
获得i(7)               获得i(7)
增加i(7->8)        -----
------                     增加i(7->8)
写回i(8)               -----
------                      写回i(8)
```

解决方法：加锁。
**死锁**：当有一个或多个执行线程和一个或多个资源，每个线程都在等待其中的一个资源，但所有的资源都已经被占用。所有的线程都在相互等待，但他们永远不会释放已经占有的资源。于是任何线程都无法继续。举一个简单例子：
```
线程1                         线程2
获得锁a                    获得锁b
试图获得锁b           试图获得锁a
等待锁b                    等待锁a
```
**预防死锁**：   
 （1）：按顺序加锁。  
 （2）：防止发生饥饿。  
 （3）：不要重复请求同一个锁。  
 （4）：设计应力求简单。  
 
